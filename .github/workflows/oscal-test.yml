name: OSCAL Testing

permissions: {}

on:
  pull_request:
    branches:
      - main
    paths:
      - "oscal/**"
      - "cmd/oscal_export/**"

jobs:
  OSCAL-Test:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          persist-credentials: false
      - uses: actions/setup-go@4dc6199c7b1a012772edbd06daecab0f50c9053c # v6.1.0
        with:
          go-version: stable
      - name: Generate OSCAL artifacts
        run: make oscalgenerate
      - name: Setup Java # this is here because oscal-cli-action below needs a java runtime
        uses: actions/setup-java@f2beeb24e141e01a676f977032f5a29d81c9e27e
        id: setup-java
        with:
          distribution: temurin
          java-version: 17
      - name: Validate OSCAL catalog
        uses: oscal-club/oscal-cli-action@6a8b6368885714e46fa1d4a65a6ce665902e08b7 # v2.1.0
        with:
          args: validate ./artifacts/catalog.json
      - name: Validate OSCAL profile
        uses: oscal-club/oscal-cli-action@6a8b6368885714e46fa1d4a65a6ce665902e08b7 # v2.1.0
        with:
          args: validate ./artifacts/profile.json
      - name: Validate OSCAL guidance catalog
        uses: oscal-club/oscal-cli-action@6a8b6368885714e46fa1d4a65a6ce665902e08b7 # v2.1.0
        with:
          args: validate ./artifacts/guidance.json
